<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">

<head th:replace="~{fragments::header}"></head>

<head>
    <title>View Orders</title>
    <!-- Include jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
	integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
	crossorigin="anonymous"></script>
</head>

<body id="page-top" class="bg-light">
    <div th:replace="~{fragments::top-bar}"></div>
    <!-- Page Wrapper -->
    <div id="wrapper">
        <div class="container-fluid">
            <div class="row">
                <div th:replace="~{fragments::sidebar}"></div>
                <div class="col-md-10  mt-4">
                    <!-- Main Content -->
                    <div id="content">
                        <div class="mt-2 card p-3 d-flex">
                            <div class="row">
                                <div class="col-md-2">
                                    <button id="generatePdf" class="btn btn-outline-primary">Export To PDF</button>
                                </div>
                                <div class="col-md-2">
                                    <button id="generateExcel" class="btn btn-outline-success">Export To Excel</button>
                                </div>
                            </div>
                        </div>
                        <!-- Begin Page Content -->
                        <div th:if="${success}" class="text-center alert alert-success">
                            <p th:text="${success}">
                            </p>
                        </div>
                        <div class="mt-3 card">
                            <table class="table table-striped table-bordered w-100" id="ordersTable">
                                <thead class="bg-dark text-white text-uppercase">
                                    <tr class="bg-white text-dark font-weight-bold text-center">
                                        <td colspan="9">VIEW ALL ORDERS</td>
                                        <td>TOTAL: <span th:text="${orders.size()}"></span></td>
                                    </tr>
                                    <tr>
                                        <th>ORDER-ID</th>
                                        <th>Customer</th>
                                        <th>Ordered Date</th>
                                        <th>Status</th>
                                        <th>Qty.</th>
                                        <th>Price</th>
                                        <th>Payment Status</th>
                                        <th>Assign DP</th>
                                        <th>Delivery Person</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white">
                                    <tr th:each="order : ${orders}">
                                        <td class="text-center">
                                            <strong class="text-dark">[(${order.id})]</strong>
                                        </td>
                                        <td>
                                            <strong
                                                class="text-dark">Name:</strong><span>[(${order.customer.firstName})]
                                                [(${order.customer.lastName})]</span>
                                            <br><strong
                                                class="text-dark">Email:</strong><span>[(${order.customer.username})]</span>
                                            <br><strong
                                                class="text-dark">Cotact:</strong><span>[(${order.customer.phoneNumber})]</span>
                                        </td>
                                        <td>
                                            <span>[(${order.orderDate})]</span>
                                        </td>
                                        <td>
                                            <a class="text-success" th:if="${order.isDelivered==true}"
                                                th:text="${order.deliveryDate + ' Delivered'}"></a>
                                            <a class="text-primary"
                                                th:if="${order.accept == true && order.isDelivered==false}"
                                                th:text="${order.orderStatus}"></a>
                                            <a class="text-warning" th:if="${order.accept == false}"
                                                th:text="${order.orderStatus}"></a>
                                        </td>
                                        <td class="text-center">
                                            <span th:text="${order.quantity}"></span>
                                        </td>
                                        <td class="text-right">
                                            <strong class="text-dark">â‚¹ [(${order.totalPrice})]</strong>
                                        </td>
                                        <td class="text-right" style="color: black"><span
                                                class="text-uppercase text-success">[(${order.status})]</span>
                                        </td>
                                        <td>
                                            <span th:if="${order.accept == true}">Assigned</span>
                                            <form th:action="@{/assign-delivery-person/{id}(id=${order.id})}"
                                                method="get">
                                                <select id="delivery_person" name="delivery_person" class="form-control"
                                                    th:if="${order.accept == false}">
                                                    <option value="">-SELECT-</option>
                                                    <option th:each="dp : ${deliveryPersons}"
                                                        th:if="${dp.isAvailable==true}" th:value="${dp.id}"
                                                        th:text="${dp.firstName + ' ' + dp.lastName}"
                                                        class="form-control"></option>
                                                </select>
                                                <button type="submit" class="text-center btn-block mt-2"
                                                    style="border:1px solid black; border-radius: 10px;"
                                                    th:if="${order.accept == false}">Assign</button>
                                            </form>
                                        </td>
                                        <td>
                                            <div th:if="${order.deliveryPerson != null}">
                                                <strong>Name:</strong><span>[(${order.deliveryPerson.firstName})]
                                                    [(${order.deliveryPerson.lastName})]</span>
                                                <strong>Mobile:</strong><span>[(${order.deliveryPerson.phoneNumber})]</span>
                                            </div>
                                        </td>
                                        <td>
                                            <a th:if="${order.accept} != false"
                                                th:href="@{/cancel-order(id = ${order.id})}"
                                                class="btn btn-primary">Cancel</a>
                                            <a th:if="${order.accept} == false"
                                                th:href="@{/accept-order(id = ${order.id})}"
                                                class=" btn btn-secondary">Accept</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of Page Wrapper -->

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
	integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
	crossorigin="anonymous"></script>

    <script type="text/javascript">

        $(document).ready(function () {
            $('#generateInvoiceButton').click(function () {
                $.ajax({
                    type: 'GET',
                    url: '/admin/generate-invoice-report', // URL of the controller endpoint
                    success: function (response) {
                        // Handle success, for example, display a success message
                        alert('Invoice report generated successfully');
                    },
                    error: function (xhr, status, error) {
                        // Handle error, for example, display an error message
                        alert('Error generating invoice report: ' + error);
                    }
                });
            });
        });

    </script>

</body>

</html>