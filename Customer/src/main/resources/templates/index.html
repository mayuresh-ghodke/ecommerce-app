<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<!-- Basic -->

<head th:replace="~{fragments::head}"></head>

<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    <style>

        .btn-size {
            width: 50%;
            height: auto;
            border-radius: 10px;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        }
        .add-to-cart{
            border-radius: 10px;
        }
        .wishlist-btn{
            border: 1px solid #de2336;
            border-radius: 20px;
            background-color: white;
            color:#de2336;
        }
    </style>
    <script src="https://kit.fontawesome.com/b982f6e503.js" crossorigin="anonymous"></script>
</head>

<body class="bg-light">
    <div th:replace="~{fragments::optional}"></div>
    <div th:replace="~{fragments::main-top}"></div>
    <div th:replace="~{fragments::main-header}"></div>

    <!-- Start Products  -->
    <div class="mt-3">
        <div class="container-fluid" th:each="category : ${categories}">
            <div class="row">
                <div class="col-lg-12 mt-2 mb-2">
                    <div class="text-uppercase text-left mb-2">
                        <h3 th:text="${category.name}" class="text-primary font-weight-bold"></h3>
                    </div>
                </div>
            </div>
            <div class="row pl-5 pr-5 mt-2">
                <div class="col-lg-3 col-md-6 special-grid" th:each="product : ${products}"
                    th:if="${category.name == product.category.name}">
                    <form th:action="@{/add-to-cart}" method="post">
                        <div class="card border-0 shadow-sm bg-white mt-2 mb-3">
                            <div class="card-body text-center">
                                <img th:src="'data:image/jpeg;base64,' + ${product.image}" alt="Product Image"
                                    style="height: 280px; width: 80%;">

                                <div class="text-center">
                                    <a th:href="@{/product-detail/{id}(id = ${product.id})}"
                                        style="text-decoration: none;">
                                        <h6 th:text="${product.name}"
                                            class="mt-4 text-center mb-0 text-uppercase font-weight-bold text-dark">
                                        </h6>
                                        <h6 th:text="'â‚¹  ' + ${product.costPrice}" class="mt-3 text-muted"></h6>
                                    </a>
                                </div>
                                <div th:if="${product.currentQuantity == 0}">
                                    <span class="text-danger">Not available in stock.</span>
                                    <form id="wishlistForm">
                                        <input type="hidden" class="productId" th:value="${product.id}">
                                        <button class="col-12 btn wishlist-btn mt-2 add-to-wishlist">
                                            <i class="fas fa-heart" style="color:pink"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                            <div class="card-body bg-white" th:if="${product.currentQuantity != 0}">
                                <div th:if="${product.currentQuantity < 5}">
                                    <span class="text-warning">Only <span th:text="${product.currentQuantity}"></span>
                                        are left.</span>
                                </div>
                                <div class="mt-2 d-flex">
                                    <form id="wishlistForm">
                                        <input type="hidden" class="productId" th:value="${product.id}">
                                        <button class="btn wishlist-btn add-to-wishlist">
                                            <i class="fas fa-heart"></i>
                                        </button>
                                    </form>
                                    
                                    <button type="submit" class="col-9 ml-1 btn btn-outline-primary add-to-cart"
                                        th:if="${product.currentQuantity !=0}">
                                        <i class="fa-solid fa-cart-plus"></i>
                                        <span>ADD TO CART</span>
                                    </button>
                                    <input type="hidden" th:value="${product.id}" name="id" class="form-control">
                                </div>
                            </div>
                        </div>
                </div>
                </form>
            </div>
        </div>
        <div class="mt-5"></div>
        <hr>
    </div>
    </div>

    <!-- End Products  -->
    <footer th:replace="~{fragments::footer}"></footer>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
	integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
	crossorigin="anonymous"></script>s

    <script>
    $(document).ready(function () {
        $('.add-to-wishlist').click(function (event) {
            event.preventDefault();
    
            const productId = $(this).siblings('.productId').val();
            
            // Send AJAX request
            $.ajax({
                url: '/shop/add-to-wishlist/'+productId, // Corrected URL
                type: 'POST', // Considering adding to the wishlist is typically a write operation, POST is more appropriate than GET
                
                success: function (response) {
                    // Parse the JSON response
                    const responseData = JSON.parse(response);
                    // Display the message using Toastr
                    toastr.success(responseData.message);
                },
                error: function (xhr, status, error) {
                    console.error('Failed to add to wishlist');
                    toastr.error('Something Went Wrong! Failed to add to wishlist');
                }
            });
        });
    });
    </script>
</body>
</html>